name: PR Handler

on:
  pull_request:
    types: [opened, closed]

jobs:
  pr-handler:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
      issues: write
      contents: read
    steps:
      - name: Check PR event type
        run: echo "Event: ${{ github.event.action }}"

      # å¤„ç†æ–°å¼€çš„PR
      - name: Greet PR Contributor (on open)
        if: github.event.action == 'opened'
        uses: actions/first-interaction@v1
        with:
          repo-token: ${{ secrets.GITHUB_TOKEN }}
          pr-message: |
            ä½ å¥½ @${{ github.actor }}ï¼Œæ„Ÿè°¢æäº¤PRï¼
            Hi @${{ github.actor }}, thanks for opening the Pull Request!
            æˆ‘ä»¬ä¼šå°½æ—©å®¡æ ¸å›åº”ğŸ˜Š
            We will respond to it as soon as possibleğŸ˜Š

      # å¤„ç†åˆå¹¶çš„PR
      - name: Thank Contributor (on merge)
        if: github.event.action == 'closed' && github.event.pull_request.merged == true
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          PR_NUMBER=${{ github.event.pull_request.number }}
          AUTHOR="${{ github.event.pull_request.user.login }}"
          MESSAGE="æ„Ÿè°¢ @$AUTHOR çš„è´¡çŒ®ï¼æ‚¨çš„PRå·²è¢«åˆå¹¶ï¼Œæ„Ÿè°¢æ‚¨ä¸ºé¡¹ç›®åšå‡ºçš„åŠªåŠ›ï¼ğŸ‰\nThank you @$AUTHOR for your contribution! Your PR has been merged. We appreciate your effort! ğŸ‰"
          
          curl -s -H "Authorization: token $GITHUB_TOKEN" \
               -H "Accept: application/vnd.github.v3+json" \
               -X POST \
               -d "{\"body\":\"$MESSAGE\"}" \
               "https://api.github.com/repos/${{ github.repository }}/issues/${PR_NUMBER}/comments"

      # å¤„ç†å…³é—­çš„PRï¼ˆæœªåˆå¹¶ï¼‰
      - name: Acknowledge Closed PR
        if: github.event.action == 'closed' && github.event.pull_request.merged == false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          PR_NUMBER=${{ github.event.pull_request.number }}
          AUTHOR="${{ github.event.pull_request.user.login }}"
          MESSAGE="@$AUTHOR è¾›è‹¦äº†ï¼è™½ç„¶è¿™æ¬¡PRæ²¡æœ‰åˆå¹¶ï¼Œä½†è¿˜æ˜¯æ„Ÿè°¢æ‚¨çš„ä»˜å‡ºï¼ŒæœŸå¾…ä¸‹æ¬¡åˆä½œï¼ğŸ™\n@$AUTHOR, thank you for your effort! Although this PR wasn't merged, we appreciate your contribution and look forward to collaborating again! ğŸ™"
          
          curl -s -H "Authorization: token $GITHUB_TOKEN" \
               -H "Accept: application/vnd.github.v3+json" \
               -X POST \
               -d "{\"body\":\"$MESSAGE\"}" \
               "https://api.github.com/repos/${{ github.repository }}/issues/${PR_NUMBER}/comments"
